# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Edge-TTS-Desktop (Working State)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ (—Ä–∞–±–æ—á–µ–µ) —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã, –æ—Ç–≤–µ—á–∞—é—â–µ–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å: "–ü–æ—á–µ–º—É —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ —Ä–∞–Ω—å—à–µ –Ω–µ—Ç?".

## 1. VLESS VPN (–û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)

–ó–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–æ–∫—Å–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –∫–ª–∞—Å—Å `VlessManager` –≤ `app/vless_manager.py`.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1.  **–ó–∞–ø—É—Å–∫**: –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`MainWindow.__init__`) —Å–æ–∑–¥–∞–µ—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä `VlessManager`.
2.  **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
    *   –ë–µ—Ä–µ—Ç VLESS-—Å—Å—ã–ª–∫—É –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`VLESS_URL`).
    *   –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è `xray.exe` (`vless_config.json`).
    *   –ó–∞–ø—É—Å–∫–∞–µ—Ç `xray.exe` –∫–∞–∫ –ø–æ–¥–ø—Ä–æ—Ü–µ—Å—Å.
3.  **–ü—Ä–æ–∫—Å–∏**: Xray –ø–æ–¥–Ω–∏–º–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π SOCKS5 –ø—Ä–æ–∫—Å–∏ –Ω–∞ –ø–æ—Ä—Ç—É `10809` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
4.  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –°—Ç—Ä–æ–∫–∞ –ø—Ä–æ–∫—Å–∏ `socks5://127.0.0.1:10809` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `TtsWorker`.

### –ü–æ—á–µ–º—É –º–æ–≥–ª–æ –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–Ω—å—à–µ:
*   **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ**: –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–ª–æ—Å—å "–∂–µ—Å—Ç–∫–æ", –ø—Ä–æ—Ü–µ—Å—Å `xray.exe` –º–æ–≥ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤–∏—Å–µ—Ç—å –∏ –∑–∞–Ω–∏–º–∞—Ç—å –ø–æ—Ä—Ç. –ú—ã –¥–æ–±–∞–≤–∏–ª–∏ `closeEvent` –≤ `MainWindow`, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —É–±–∏–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å.
*   **–¢–∞–π–º–∞—É—Ç—ã**: Xray —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç. –ú—ã –∂–¥–µ–º –µ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—å "–ì–æ—Ç–æ–≤–æ".

## 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ê—É–¥–∏–æ (TTS Worker)

–ó–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç–≤–µ—á–∞–µ—Ç `TtsWorker` –≤ `app/tts_worker.py`. –≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ (`QThread`), —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∑–∞–≤–∏—Å–∞–ª.

### –¶–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–∞:
1.  **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –Ω–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–æ—Å–ª—É—à–∞—Ç—å" –∏–ª–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å".
2.  **MainWindow** —Å–æ–±–∏—Ä–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ç–µ–∫—Å—Ç, –≥–æ–ª–æ—Å, —Å–∫–æ—Ä–æ—Å—Ç—å) –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `worker.process_request()`.
3.  **Worker** (–≤–Ω—É—Ç—Ä–∏ `run()`):
    *   –ö—Ä—É—Ç–∏—Ç –≤–µ—á–Ω—ã–π —Ü–∏–∫–ª `asyncio` (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å).
    *   –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞—á—É –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `edge_tts`.

### üõ† –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–ü–æ—á–µ–º—É –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ):

–ò–º–µ–Ω–Ω–æ —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—á–∏–Ω–∏–ª–∏ –æ—à–∏–±–∫–∏ "NoAudioReceived" –∏ –≤—ã–ª–µ—Ç—ã:

#### –ê. WindowsProactorEventLoopPolicy (–ì–õ–ê–í–ù–û–ï)
`edge-tts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `aiohttp`, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞ Windows —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã (`ProactorEventLoop`).
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –í –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ Python —Å—Ç–∞–≤–∏—Ç –µ–≥–æ —Å–∞–º. –ù–æ –≤ `QThread` (–≥–¥–µ –∂–∏–≤–µ—Ç –Ω–∞—à –≤–æ—Ä–∫–µ—Ä) —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –æ–±—ã—á–Ω—ã–π `SelectorEventLoop`, –∫–æ—Ç–æ—Ä—ã–π **–Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º** —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ —Å–µ—Ç–µ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –Ω–∞ Windows.
*   **–†–µ—à–µ–Ω–∏–µ**: –ú—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏–ª–∏ `asyncio.set_event_loop_policy(asyncio.WindowsProactorEventLoopPolicy())` –≤–Ω—É—Ç—Ä–∏ `TtsWorker.run()`.
*   **–°–∏–º–ø—Ç–æ–º –±–µ–∑ —Ñ–∏–∫—Å–∞**: –û—à–∏–±–∫–∏ —Å–µ—Ç–∏, —Ç–∞–π–º–∞—É—Ç—ã, "NoAudioReceived" –¥–∞–∂–µ –ø—Ä–∏ —Ä–∞–±–æ—á–µ–º VPN.

#### –ë. –£–¥–∞–ª–µ–Ω–∏–µ TensorFlow / Russtress
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `russtress` (–¥–ª—è —É–¥–∞—Ä–µ–Ω–∏–π) –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∑–∞–≥—Ä—É–∂–∞–ª–∞ –æ–≥—Ä–æ–º–Ω—ã–π TensorFlow. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã DLL, —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –∏ –º–æ–≥–ª–æ "–≤–µ—à–∞—Ç—å" –ø–æ—Ç–æ–∫ –≤–æ—Ä–∫–µ—Ä–∞.
*   **–†–µ—à–µ–Ω–∏–µ**: –ú—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã—Ä–µ–∑–∞–ª–∏ `russtress` –∏ TensorFlow.
*   **–ß–µ–º –∑–∞–º–µ–Ω–∏–ª–∏**: –¢–µ–ø–µ—Ä—å —É–¥–∞—Ä–µ–Ω–∏—è (—Ñ–æ–Ω–µ–º—ã) —Ä–∞—Å—Å—Ç–∞–≤–ª—è–µ—Ç Gemini (Thinking Mode), –∞ Edge TTS –ø–æ–ª—É—á–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ `raw_ssml=True`. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ.

#### –í. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –†–∞–Ω—å—à–µ –æ—à–∏–±–∫–∏ "–≥–ª–æ—Ç–∞–ª–∏—Å—å" –∏–ª–∏ –≤—ã–≤–æ–¥–∏–ª–∏—Å—å –Ω–µ —Ç—É–¥–∞.
*   **–†–µ—à–µ–Ω–∏–µ**: –ú—ã –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ `logging.basicConfig` –≤ `main.py`, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏.

## 3. –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

```mermaid
graph TD
    User[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] -->|–ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É| UI[MainWindow]
    UI -->|–ó–∞–ø—É—Å–∫–∞–µ—Ç| VLESS[VlessManager (xray.exe)]
    VLESS -->|SOCKS5 Proxy| Worker
    
    UI -->|–¢–µ–∫—Å—Ç + –ù–∞—Å—Ç—Ä–æ–π–∫–∏| Worker[TtsWorker (QThread)]
    
    subgraph "TtsWorker (Async Loop)"
        Worker -->|1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞| Pipeline[Text Pipeline]
        Pipeline -->|2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–æ–ø—Ü–∏—è)| Gemini[Gemini API]
        Worker -->|3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è| EdgeTTS[edge-tts Library]
    end
    
    EdgeTTS -->|–ó–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ Proxy| MS[Microsoft Server]
    MS -->|–ê—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ| EdgeTTS
    EdgeTTS -->|–§–∞–π–ª mp3| Disk[–î–∏—Å–∫]
    Worker -->|–°–∏–≥–Ω–∞–ª finished| UI
```

## –†–µ–∑—é–º–µ

–í–∞—à–∞ –≤–µ—Ä—Å–∏—è —Å 4 –∫–æ–º–º–∏—Ç–∞–º–∏, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –∏–∑-–∑–∞ **–ø—É–Ω–∫—Ç–∞ –ê (Loop Policy)**. –≠—Ç–æ –æ—á–µ–Ω—å —Ö–∏—Ç—Ä–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å Python –Ω–∞ Windows –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø–æ—Ç–æ–∫–∞–º–∏. –ë–µ–∑ —ç—Ç–æ–π —Å—Ç—Ä–æ—á–∫–∏ –∫–æ–¥–∞ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ —Å–æ—Å–µ–¥–Ω–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ "—É–º–∏—Ä–∞—é—Ç" –∏–ª–∏ –≤–µ–¥—É—Ç —Å–µ–±—è –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ.
